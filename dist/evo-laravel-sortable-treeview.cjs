"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require('./index.css');const e=require("vue"),C=require("vue-draggable-plus"),x=require("@vueuse/core"),b=require("@evomark/vue-forward-slots"),E=require("@inertiajs/vue3"),N=require("lodash-es"),V=require("axios");var B="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z",H="M9,3H11V5H9V3M13,3H15V5H13V3M9,7H11V9H9V7M13,7H15V9H13V7M9,11H11V13H9V11M13,11H15V13H13V11M9,15H11V17H9V15M13,15H15V17H13V15M9,19H11V21H9V19M13,19H15V21H13V19Z";const h=Symbol.for("sortable-treeview"),T={transform:"rotate(var(--r, 0deg)) scale(var(--sx, 1), var(--sy, 1))"},y={mdi:{size:24,viewbox:"0 0 24 24"},"simple-icons":{size:24,viewbox:"0 0 24 24"},default:{size:0,viewbox:"0 0 0 0"}},k={props:{type:{type:String,required:!0},path:{type:[String,Object,Array],required:!1},pathString:{type:[Array,String,Object],required:!1}},setup(t){return()=>t.type==="fad"?(console.warn("vue3-icon does not currently support Duotone FontAwesome icons"),e.h("path")):Array.isArray(t.path)?e.h("g",{style:{fill:"currentcolor"}},t.path.map(r=>typeof r=="string"?e.h("path",{d:r}):e.h("path",{...r}))):e.h("path",{d:t.pathString,style:{fill:"currentcolor"}})}},_={name:"icon",props:{type:{type:String,default:"mdi"},faIcon:{type:Object,default:null},path:{type:[String,Object,Array]},size:{type:[Number,String],default:24},viewbox:{type:String,required:!1},flip:{type:String,default:"",validator:t=>["","horizontal","vertical","both"].includes(t)},rotate:{type:[Number,String],default:0},noNamespace:{type:Boolean,default:!1},noStyles:{type:Boolean,default:!1},noDimensions:{type:Boolean,default:!1}},setup(t){if(!t.path&&!t.faIcon)return console.warn("vue3-icon requires either a 'path' or an 'fa-icon' property"),()=>e.h("div");const r=e.computed(()=>{var o;return((o=t.faIcon)==null?void 0:o.prefix)||t.type}),a=e.computed(()=>parseInt(t.rotate,10)),c=e.computed(()=>y[r.value]||y.default),p=e.computed(()=>parseInt(t.size,10)||c.value.size),s=e.computed(()=>t.faIcon?`0 0 ${t.faIcon.icon[0]} ${t.faIcon.icon[1]}`:!1),l=e.computed(()=>s.value||t.viewbox||c.value.viewbox),i=e.computed(()=>{if(t.noStyles!==!0)return{...T,"--sx":["both","horizontal"].includes(t.flip)?"-1":"1","--sy":["both","vertical"].includes(t.flip)?"-1":"1","--r":isNaN(a.value)?a.value:a.value+"deg"}}),d=e.computed(()=>{var o;return t.faIcon?(o=t.faIcon)==null?void 0:o.icon[4]:t.type==="simple-icons"&&typeof t.path=="object"?t.path.path:t.path});return()=>e.h("svg",{xmlns:t.noNamespace!==!0?"http://www.w3.org/2000/svg":void 0,style:i.value,class:["vue3-icon"],width:t.noDimensions!==!0?p.value:void 0,height:t.noDimensions!==!0?p.value:void 0,viewBox:l.value},[e.h(k,{path:t.path,type:r.value,pathString:d.value})])}},j={class:"evo-sortable-treeview__item"},q={class:"evo-sortable-treeview__item-content"},I={ref:"item",class:"evo-sortable-treeview__actions"},M={class:"evo-sortable-treeview__action-drag"},L={class:"evo-sortable-treeview__action-title"},O={class:"evo-sortable-treeview__columns"},z=Object.assign({name:"EvoSortableTreeviewItem"},{__name:"_SortableTreeviewItem",props:{item:{type:Object,required:!0},depth:{type:Number,required:!0}},setup(t){const r=t;e.useId(),useTemplateRef("item");const a=inject(h),c=computed(()=>a.config.value.itemTitle),p=computed(()=>a.config.value.itemValue),s=computed(()=>a.config.value.itemChildren),l=computed(()=>a.config.value.itemChildrenCount),i=ref([]),d=computed(()=>{var u,v;return r.item[l.value]>0||(u=i.value)!=null&&u.length?!0:!!(Array.isArray(r.item[s.value])&&((v=r.item[s.value])==null?void 0:v.length)>0)}),o=ref(!1);x.syncRef(()=>r.item[s.value],i,{direction:"ltr",transform:{ltr:u=>u},immediate:!0});const m=computed(()=>{var u;return d.value&&((u=i.value)==null?void 0:u.length)>0}),n=ref(!1),f=()=>{if(n.value||m.value)return n.value=!n.value;o.value=!0,a.onLoadChildren(r.item).then(u=>{i.value=u.data.children??[],n.value=!n.value}).finally(()=>{o.value=!1})};return(u,v)=>{const g=e.resolveComponent("VBtn");return e.openBlock(),e.createElementBlock("li",j,[e.createElementVNode("div",q,[e.createElementVNode("div",I,[e.createElementVNode("div",{class:e.normalizeClass(["evo-sortable-treeview__action-expand",{"is-expanded":e.unref(n)}])},[e.unref(d)?(e.openBlock(),e.createBlock(g,{key:0,icon:"",variant:"flat",size:"small",loading:e.unref(o),onClick:f},{default:e.withCtx(()=>[e.createVNode(e.unref(_),{class:"evo-sortable-treeview__expand-icon",size:"24",path:e.unref(B),rotate:e.unref(n)?90:0},null,8,["path","rotate"])]),_:1},8,["loading"])):e.createCommentVNode("",!0)],2),e.createElementVNode("div",M,[e.createVNode(g,{variant:"plain",size:"small",class:"drag-handle cursor-move"},{default:e.withCtx(()=>[e.createVNode(e.unref(_),{path:e.unref(H)},null,8,["path"])]),_:1})]),e.createElementVNode("div",L,[e.renderSlot(u.$slots,"item.title",{item:r.item,title:r.item[e.unref(c)]},()=>[e.createTextVNode(e.toDisplayString(r.item[e.unref(c)]),1)])])],512),v[1]||(v[1]=e.createElementVNode("div",{class:"evo-sortable-treeview__spacer"},null,-1)),e.createElementVNode("div",O,[e.renderSlot(u.$slots,"item.columns",{item:r.item})])]),e.createVNode(e.unref(b.ForwardSlots),{slots:u.$slots},{default:e.withCtx(()=>[e.createVNode(w,{modelValue:e.unref(i),"onUpdate:modelValue":v[0]||(v[0]=S=>e.isRef(i)?i.value=S:null),"is-expanded":e.unref(n),"is-empty":!e.unref(d),depth:r.depth+1,"parent-id":r.item[e.unref(p)]},null,8,["modelValue","is-expanded","is-empty","depth","parent-id"])]),_:1},8,["slots"])])}}}),w=Object.assign({name:"EvoSortableTreeviewChildren"},{__name:"_SortableTreeviewChildren",props:e.mergeModels({depth:{type:Number,required:!0},parentId:{type:[String,Number],default:null},isEmpty:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!1}},{modelValue:{type:Array,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const r=e.useModel(t,"modelValue"),a=t,c=e.inject(h),p=computed(()=>c.config.value.itemValue),s=computed(()=>({class:"evo-sortable-treeview__drag-area",style:{minHeight:a.isEmpty?"1px":"",paddingLeft:a.parentId?"1rem":"0px"},tag:"ul",group:c.group,draggable:"li",handle:".drag-handle","onUpdate:modelValue":l=>c.onSorted(l,a.parentId)}));return(l,i)=>{const d=e.resolveComponent("VExpandTransition");return e.openBlock(),e.createBlock(d,null,{default:e.withCtx(()=>[a.isExpanded||a.isEmpty?(e.openBlock(),e.createBlock(e.unref(C.VueDraggable),e.mergeProps({key:0,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=o=>r.value=o)},e.unref(s)),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,o=>(e.openBlock(),e.createBlock(z,{key:`${o[e.unref(p)]}_item`,item:o,depth:a.depth},e.createSlots({_:2},[e.renderList(l.$slots,(m,n)=>({name:n,fn:e.withCtx(f=>[e.renderSlot(l.$slots,n,e.mergeProps({ref_for:!0},f))])}))]),1032,["item","depth"]))),128))]),_:3},16,["modelValue"])):e.createCommentVNode("",!0)]),_:3})}}}),$={ref:"treeview",class:"evo-sortable-treeview"},A=Object.assign({name:"EvoSortableTreeview"},{__name:"SortableTreeview",props:{model:{type:[String,Object],required:!0}},emits:["sorted"],setup(t,{emit:r}){const a=e.useId(),c=r,p=t,s=computed(()=>typeof p.model=="string"?E.usePage().props[p.model]:p.model),l=computed(()=>{var o;return((o=s.value)==null?void 0:o.config)??{}}),i=computed(()=>{var o;return((o=s.value)==null?void 0:o.data)??s.value}),d=ref(i.value);return watch(i,o=>{d.value=o}),e.provide(h,{group:a,config:l,treeProps:computed(()=>N.pick(p,["itemChildren","itemChildrenCount","itemTitle","itemValue"])),onSorted:(o,m)=>{const n=o.map(f=>f[l.value.itemValue])??[];return c("sorted",{parentId:m,ids:n,$event:o}),V({url:l.value.updateSortOrderRoute,method:l.value.updateSortOrderMethod,data:{model:s.value.modelClass,parent_id:m,ids:n},withCredentials:!0,headers:{"Content-Type":"application/json",Accept:"application/json"},responseType:"json"})},onLoadChildren:o=>V({url:l.value.loadChildrenRoute,method:l.value.loadChildrenMethod,params:{model:s.value.modelClass,model_id:o[l.value.itemValue]},withCredentials:!0})}),(o,m)=>(e.openBlock(),e.createElementBlock("div",$,[e.createElementVNode("header",{class:"evo-sortable-treeview__header",style:e.normalizeStyle({"--max-columns-width":`${o.maxColumnsWidth}px`})},[m[1]||(m[1]=e.createElementVNode("div",{class:"evo-sortable-treeview__spacer"},null,-1)),e.renderSlot(o.$slots,"header")],4),e.createVNode(e.unref(b.ForwardSlots),{slots:o.$slots},{default:e.withCtx(()=>[e.createVNode(w,{modelValue:e.unref(d),"onUpdate:modelValue":m[0]||(m[0]=n=>e.isRef(d)?d.value=n:null),depth:0,"is-expanded":""},null,8,["modelValue"])]),_:1},8,["slots"])],512))}});exports.EvoSortableTreeview=A;
